<!DOCTYPE html>
<html lang="en" translate="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <meta name="google" content="notranslate">
    <title>üìò Buku Kerja Bab 13 ¬∑ Acak + Anti Copy</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        body {
            font-family: 'Comic Neue', 'Segoe UI', cursive, sans-serif;
            background: linear-gradient(145deg, #f9e7b2 0%, #ffd5a4 100%);
            min-height: 100vh; display: flex; justify-content: center; align-items: center;
            padding: 16px; position: relative; overflow-x: hidden;
        }
        body::before {
            content: "‚öîÔ∏èüõ°Ô∏è"; font-size: 100px; position: absolute; top: 10px; left: 10px;
            opacity: 0.15; transform: rotate(-10deg); pointer-events: none;
        }
        body::after {
            content: "üêâüè∞"; font-size: 120px; position: absolute; bottom: 10px; right: 10px;
            opacity: 0.15; transform: rotate(5deg); pointer-events: none;
        }
        .container {
            max-width: 1200px; width: 100%; background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(6px); border-radius: 60px; box-shadow: 0 20px 30px rgba(0,0,0,0.2),
                0 0 0 8px #ffe28c, 0 0 0 12px #ffb882; padding: 24px 20px 30px; border: 4px solid #ffaa66;
        }
        .credit {
            text-align: center; font-size: 1.3rem; font-weight: bold; color: #8b4513;
            background: #ffe9c4; padding: 10px; border-radius: 40px; margin-bottom: 15px;
            border: 3px solid #e0a56b; box-shadow: 0 5px 0 #b2723a;
        }
        .identity-bar {
            background: #d2f0d2; padding: 15px 20px; border-radius: 50px; margin-bottom: 20px;
            border: 3px solid #4caf50; display: flex; flex-wrap: wrap; align-items: center;
            justify-content: center; gap: 15px; font-size: 1.2rem; box-shadow: 0 6px 0 #357a38;
        }
        .identity-bar input {
            padding: 10px 20px; font-size: 1.2rem; border-radius: 40px; border: 3px solid #fb8b67;
            background: white; font-family: 'Comic Neue', cursive; outline: none; width: 250px;
        }
        .identity-bar button {
            background: #fea1a1; border: none; padding: 10px 30px; border-radius: 40px;
            font-size: 1.2rem; font-weight: bold; color: white; border-bottom: 5px solid #b15353;
            cursor: pointer;
        }
        .identity-bar button:active { transform: translateY(3px); border-bottom-width: 2px; }
        .player-info {
            background: #feeac9; border-radius: 30px; padding: 8px 25px; font-size: 1.3rem;
            border: 2px solid #d98f4c;
        }
        .header {
            display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center;
            background: #b0e0ff; padding: 16px 25px; border-radius: 50px; margin-bottom: 25px;
            border: 3px solid #f08080; box-shadow: inset 0 -3px 0 #8ab3cf, 0 8px 0 #8b6b4d;
            font-weight: bold;
        }
        .timer-box {
            background: #2e1b0e; color: #f9e081; padding: 12px 24px; border-radius: 40px;
            font-size: 1.7rem; font-family: 'Courier New', monospace; letter-spacing: 3px;
            text-shadow: 0 2px 0 #b87c4b; box-shadow: 0 5px 0 #5a3e2b; border: 2px solid #f7c46e;
        }
        .per-question-timer {
            background: #fea3aa; padding: 8px 20px; border-radius: 30px; color: white;
            font-size: 1.4rem; border: 2px solid #fff0b5; box-shadow: 0 4px 0 #b45f5f;
        }
        .tabs { display: flex; gap: 20px; }
        .tab {
            background: #ffcf96; padding: 12px 35px; border-radius: 40px; font-size: 1.5rem;
            font-weight: bold; color: #4b2e1a; cursor: pointer; border: 3px solid #fff5d0;
            box-shadow: 0 7px 0 #b47c4d; transition: 0.1s; text-shadow: 0 1px 0 white;
        }
        .tab.active { background: #ffb156; box-shadow: 0 3px 0 #b47c4d; transform: translateY(4px); border-color: #ffeaa5; }
        .question-area {
            background: #fff9e6; border-radius: 70px; padding: 30px; border: 5px solid #ffc586;
            box-shadow: inset 0 0 0 4px #ffe1b3, 0 15px 0 #b2814a; margin: 20px 0 30px;
        }
        .question-header {
            display: flex; justify-content: space-between; align-items: center; background: #dbb88c;
            border-radius: 40px; padding: 8px 25px; margin-bottom: 25px; color: white;
            font-size: 1.4rem; border: 2px solid #ffda9e;
        }
        .play-audio {
            background: #ffb054; border: none; border-radius: 50px; padding: 12px 25px;
            font-size: 1.3rem; font-weight: bold; color: white; cursor: pointer;
            border-bottom: 6px solid #a06028; box-shadow: 0 4px 0 #7b451b; transition: 0.05s;
        }
        .play-audio:active { transform: translateY(4px); border-bottom-width: 2px; }
        .question-text {
            font-size: 1.5rem; background: #ffefd2; padding: 30px 25px; border-radius: 50px;
            border: 3px dashed #ff9f5b; line-height: 1.6; color: #3f280e; margin-bottom: 30px;
        }
        .options {
            display: flex; flex-direction: column; gap: 18px; margin: 20px 0;
        }
        .option {
            background: #fef7d5; padding: 18px 25px; border-radius: 50px; border: 3px solid #c98f5e;
            font-size: 1.3rem; display: flex; align-items: center; cursor: pointer;
            box-shadow: 0 6px 0 #ab7c4d; transition: 0.15s;
        }
        .option:hover { background: #ffe5b4; transform: scale(1.01); }
        .option.selected { background: #b0e57c; border-color: #4caf50; box-shadow: 0 4px 0 #2e7d32; transform: translateY(2px); color: #1d3c1d; }
        .option input[type="radio"] {
            appearance: none; width: 28px; height: 28px; background: white; border-radius: 50%;
            border: 3px solid #d2691e; margin-right: 25px; cursor: pointer;
        }
        .option input[type="radio"]:checked { background: #ffae42; border-color: #aa4e1c; box-shadow: 0 0 0 3px #ffe68f; }
        .image-options {
            display: flex; justify-content: space-around; gap: 20px; flex-wrap: wrap; margin: 30px 0;
        }
        .image-option {
            background: #feeac9; border: 5px solid #d9894b; border-radius: 60px; padding: 20px;
            text-align: center; cursor: pointer; box-shadow: 0 10px 0 #aa6733; transition: 0.1s;
            flex: 1 1 150px;
        }
        .image-option.selected { background: #c5e0b4; border-color: #548235; transform: translateY(5px); box-shadow: 0 5px 0 #3b5e1f; }
        .image-option span { font-size: 5rem; display: block; line-height: 1.2; }
        .image-option .letter { font-size: 2rem; font-weight: bold; color: #6b3f1c; margin-top: 10px; }
        
        /* Style untuk grid gambar matching */
        .matching-grid {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            background: #f5e5c8;
            border-radius: 60px;
            padding: 30px;
            border: 4px solid #ffb882;
        }
        .grid-item {
            text-align: center;
            background: #fff0d4;
            border-radius: 40px;
            padding: 15px;
            border: 3px solid #d99b5b;
            box-shadow: 0 8px 0 #b2723a;
            min-width: 100px;
        }
        .grid-item span {
            font-size: 4rem;
            display: block;
        }
        .grid-item .label {
            font-size: 2rem;
            font-weight: bold;
            color: #6b3f1c;
            margin-top: 10px;
        }
        .letter-options {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        .letter-option {
            background: #feeac9;
            border: 4px solid #d9894b;
            border-radius: 60px;
            padding: 20px 30px;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 8px 0 #aa6733;
            transition: 0.1s;
            min-width: 100px;
            text-align: center;
        }
        .letter-option.selected {
            background: #c5e0b4;
            border-color: #548235;
            transform: translateY(4px);
            box-shadow: 0 4px 0 #3b5e1f;
        }
        .nav-panel {
            display: flex; justify-content: space-between; align-items: center; margin-top: 25px; flex-wrap: wrap; gap: 15px;
        }
        .question-nav {
            display: flex; flex-wrap: wrap; gap: 12px; background: #ffdcaa; padding: 15px 20px;
            border-radius: 60px; border: 3px solid #ffb457;
        }
        .nav-btn {
            background: #f0f0f0; border: 3px solid #cb7b3c; color: #4b2e1a; font-size: 1.5rem;
            font-weight: bold; width: 55px; height: 55px; border-radius: 30px; cursor: pointer;
            box-shadow: 0 5px 0 #9b6b3e;
        }
        .nav-btn:active { transform: translateY(4px); box-shadow: 0 1px 0 #9b6b3e; }
        .nav-btn.active-question { background: #ffb156; border-color: #fff1b5; color: white; }
        .action-btns { display: flex; gap: 15px; }
        .action-btn {
            background: #fea1a1; border: none; padding: 15px 35px; border-radius: 40px;
            font-size: 1.4rem; font-weight: bold; color: white; border-bottom: 7px solid #b15353;
            cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            opacity: 0.6;
            pointer-events: none;
        }
        .action-btn.active {
            opacity: 1;
            pointer-events: auto;
        }
        .action-btn:active { border-bottom-width: 2px; transform: translateY(5px); }
        .action-btn.submit { background: #6ecf8b; border-bottom-color: #2d7842; }
        .report-card {
            background: #fffcd1; border-radius: 60px; padding: 30px; border: 6px solid #f7b731;
            margin-top: 30px; box-shadow: 0 15px 0 #c58f38;
        }
        .score-row {
            display: flex; gap: 40px; justify-content: center; font-size: 2rem; flex-wrap: wrap;
        }
        .badge { background: #56b4e9; padding: 15px 30px; border-radius: 40px; color: white; box-shadow: 0 8px 0 #2a6b96; }
        .review-btn {
            background: #f2c94c; border: none; padding: 15px 35px; border-radius: 40px;
            font-size: 1.4rem; font-weight: bold; border-bottom: 7px solid #b47d26; cursor: pointer; margin-top: 20px;
        }
        .hidden { display: none; }
        .review-list {
            max-height: 400px; overflow-y: auto; background: #f3e1c2; border-radius: 40px;
            padding: 20px; margin-top: 20px; border: 3px solid #e3a56d;
        }
        .review-item {
            background: #fff4dd; padding: 15px; border-radius: 30px; margin-bottom: 15px;
            border-left: 15px solid #ff7f7f;
        }
        .footer { text-align: center; margin-top: 30px; color: #8b5a2b; }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
</head>
<body oncontextmenu="return false" onselectstart="return false" oncopy="return false" oncut="return false" onpaste="return false" ondragstart="return false">
<div class="container" id="app">
    <div class="credit">‚ö° by lcnpalembang-08994477988 ‚ö°</div>
    <div class="identity-bar">
        <span>üë§ Nama/Nomor:</span>
        <input type="text" id="playerIdInput" placeholder="Masukkan nama atau nomor" value="">
        <button id="setPlayerBtn">Simpan</button>
        <span class="player-info" id="playerDisplay">Belum diisi</span>
    </div>

    <div class="header">
        <div class="timer-box" id="globalTimer">15:00</div>
        <div class="per-question-timer" id="questionTimer">01:00</div>
        <div class="tabs">
            <div class="tab active" id="tabListening">üéß Listening (1-15)</div>
            <div class="tab" id="tabReading">üìñ Reading (16-35)</div>
        </div>
    </div>

    <div id="questionArea" class="question-area"></div>

    <div class="nav-panel">
        <div class="question-nav" id="questionNav"></div>
        <div class="action-btns">
            <button class="action-btn" id="prevBtn">‚óÄ Sebelumnya</button>
            <button class="action-btn" id="nextBtn">Selanjutnya ‚ñ∂</button>
            <button class="action-btn submit" id="submitBtn" disabled>‚úÖ Submit</button>
        </div>
    </div>

    <div id="reportSection" class="report-card hidden">
        <h2 style="text-align:center; color:#4f2f0e;">üìã Laporan Hasil</h2>
        <div id="playerReport" style="text-align:center; font-size:1.5rem; background:#ffeac2; border-radius:40px; padding:10px; margin-bottom:20px;"></div>
        <div class="score-row">
            <div class="badge" id="listeningScore">Listening: 0/15</div>
            <div class="badge" id="readingScore">Reading: 0/20</div>
            <div class="badge" id="totalScore">Total: 0/35</div>
        </div>
        <button class="review-btn" id="reviewBtn">üîç Review Jawaban Salah</button>
        <div id="reviewDetails" class="review-list hidden"></div>
        <button class="review-btn" id="closeReportBtn" style="background:#b0b0b0;">Tutup Laporan</button>
    </div>

    <div class="footer">‚ö° Ragnarok kartun ¬∑ HSK 2 latihan interaktif ‚ö°</div>
</div>

<script>
(function() {
    // ===================== FUNGSI PENGACAKAN =====================
    function shuffleArray(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    // Acak opsi dan sesuaikan correct
    function shuffleOptions(question) {
        if (question.type === 'image' || question.type === 'image-choice' || question.type === 'audio-options' || question.type === 'mc6' || question.type === 'match' || question.type === 'tf') {
            const opts = question.options.slice();
            const correctIndex = question.correct.charCodeAt(0) - 65; // 0-based index
            const correctValue = opts[correctIndex];
            shuffleArray(opts);
            const newCorrectIndex = opts.indexOf(correctValue);
            question.options = opts;
            question.correct = String.fromCharCode(65 + newCorrectIndex);
        }
        // Untuk matching-images, tidak perlu acak opsi karena pilihan adalah huruf A-F tetap
    }

    // ===================== DATA SOAL LISTENING (1-15) AWAL =====================
    const rawListening = [
        { id: 1, type: 'image', audioText: 'Â§ßÂç´ÂºÄÁùÄËΩ¶Âá∫Âéª‰∫Ü„ÄÇ', options: ['üöó', 'üö∂', 'üö≤'], correct: 'A' },
        { id: 2, type: 'image', audioText: 'ÈÇ£‰∏™Á¨ëÁùÄËØ¥ËØùÁöÑÂ•≥Â≠©ÂÑøÊòØË∞ÅÔºü', options: ['üòÑ', 'üò¢', 'üò†'], correct: 'A' },
        { id: 3, type: 'image', audioText: 'ÈÇ£‰∏™ÊâãÈáåÊãøÁùÄÈìÖÁ¨îÁöÑ‰∫∫ÊòØÊàëÊúãÂèã„ÄÇ', options: ['‚úèÔ∏è', 'üìö', '‚úÇÔ∏è'], correct: 'A' },
        { id: 4, type: 'image', audioText: 'ÊàëÁöÑÂ•≥ÊúãÂèãÈïøÁùÄ‰∏§‰∏™Â§ßÁúºÁùõÔºåÈùûÂ∏∏Áà±Á¨ë„ÄÇ', options: ['üëÄüòÑ', 'üëÄüò¢', 'üëÄüò†'], correct: 'A' },
        { id: 5, type: 'image', audioText: 'ËøôÂÑøÁ¶ªÊñ∞‰∫¨ÂÆæÈ¶Ü‰∏çÂ§™ËøúÔºåÂà∞ÂâçÈù¢ÁöÑË∑ØÂè£ÂÜçÂæÄÂè≥„ÄÇ', options: ['üè®', 'üè™', 'üè´'], correct: 'A' },
        { id: 6, type: 'image', audioText: 'Áî∑ÔºöÈÇ£‰∏™ÈùûÂ∏∏Áà±Á¨ëÁöÑÂ•≥Â≠©ÂÑøÊòØË∞ÅÔºüÂ•≥Ôºö‰Ω†‰∏çËÆ§ËØÜÂ•πÂêóÔºüÂ•πÂè´Á¨ëÁ¨ëÔºåÊòØÁéãËÄÅÂ∏àÁöÑÂ•≥ÂÑø„ÄÇ', options: ['üëß', 'üë©', 'üëµ'], correct: 'A' },
        { id: 7, type: 'image', audioText: 'Â•≥ÔºöËØ∑ÈóÆÔºåËøôÂÑøÁ¶ªÂïÜÂ∫óËøúÂêóÔºüÁî∑Ôºö‰∏çËøúÔºåÂæÄÂâçËµ∞Ôºå‰∏ã‰∏Ä‰∏™Ë∑ØÂè£Â∞±ÊòØ„ÄÇ', options: ['üè™', 'üè®', 'üè´'], correct: 'A' },
        { id: 8, type: 'image', audioText: 'Áî∑ÔºöÈÇ£‰∏™ÊâãÈáåÊãøÁùÄÈìÖÁ¨îÁöÑÂ≠©Â≠êÊòØ‰Ω†Â¶πÂ¶πÂêóÔºüÂ•≥Ôºö‰∏çÊòØÔºåÂ•πÊòØÊàëÂêåÂ≠¶ÁöÑÂ¶πÂ¶π„ÄÇ', options: ['üëß‚úèÔ∏è', 'üë¶‚úèÔ∏è', 'üë©‚úèÔ∏è'], correct: 'A' },
        { id: 9, type: 'image', audioText: 'Â•≥ÔºöÊ§ÖÂ≠ê‰∏äÂùêÁùÄÁöÑÈÇ£‰∏™‰∫∫ÊòØË∞ÅÔºüÁî∑ÔºöÊòØÊàëÁà∏Áà∏„ÄÇ‰ªñÊúâÁÇπÂÑøÁ¥ØÔºåÊ≠£‰ºëÊÅØÂë¢„ÄÇ', options: ['üë®‚Äçü¶∞', 'üë¥', 'üë¶'], correct: 'A' },
        { id: 10, type: 'image', audioText: 'Áî∑ÔºöÁé∞Âú®ÂÖ´ÁÇπÂçÅÂàÜ‰∫ÜÔºå‰Ω†Âà∞Êú∫Âú∫‰∫ÜÂêóÔºüÂ•≥ÔºöÊ≤°ÊúâÔºåÊàëËøòÂú®Âá∫ÁßüËΩ¶‰∏äÂë¢ÔºåÂæàÂø´Â∞±Âà∞„ÄÇ', options: ['üöñ', 'üöå', 'üö≤'], correct: 'A' },
        { id: 11, type: 'audio-options', audioText: 'Áî∑ÔºöËØ∑ÈóÆÊùéÂÖàÁîüÂú®ÂÖ¨Âè∏ÂêóÔºüÂ•≥Ôºö‰ªñÂºÄÁùÄËΩ¶Âá∫Âéª‰∫ÜÔºå‰Ω†‰∏ãÂçàÂÜçÊù•Âêß„ÄÇÈóÆÔºöÊùéÂÖàÁîüÂú®Âì™ÂÑøÔºü', options: ['A Âú®ÂÖ¨Âè∏', 'B Âú®ÂÆ∂Èáå', 'C Âú®Â§ñÈù¢'], correct: 'C' },
        { id: 12, type: 'audio-options', audioText: 'Â•≥ÔºöÂ§ßÂç´ÊòØÊù®Á¨ëÁ¨ëÁöÑÁî∑ÊúãÂèãÂêóÔºüÁî∑ÔºöÊòØÊù®Á¨ëÁ¨ëÁöÑÂâçÁî∑Âèã„ÄÇÈóÆÔºöÂ§ßÂç´Áé∞Âú®ÊòØÊù®Á¨ëÁ¨ëÁöÑÁî∑ÊúãÂèãÂêóÔºü', options: ['A ÊòØ', 'B ‰∏çÊòØ', 'C ‰∏çÁü•ÈÅì'], correct: 'B' },
        { id: 13, type: 'audio-options', audioText: 'Áî∑Ôºö‰Ω†ÁöÑ‰π¶Â§™Â§ö‰∫ÜÔºåÊàëÂ∏Æ‰Ω†ÊãøÁùÄÂêß„ÄÇÂ•≥Ôºö‰∏çÁî®‰∫ÜÔºåÊàë‰∏Ä‰∏™‰∫∫Â∞±ÂèØ‰ª•‰∫Ü„ÄÇÈóÆÔºöÁî∑ÁöÑ‰∏∫‰ªÄ‰πàË¶ÅÂ∏ÆÂ•≥ÁöÑÊãø‰π¶Ôºü', options: ['A ‰π¶Â§™Â§ß', 'B ‰π¶Â§™Â§ö', 'C ‰π¶Â§™Ë¥µ'], correct: 'B' },
        { id: 14, type: 'audio-options', audioText: 'Áî∑Ôºö‰∏∫‰ªÄ‰πà‰Ω†ÊØèÂ§©ÈÉΩÁ©øÁùÄÁ∫¢Ëâ≤ÁöÑË°£ÊúçÔºüÂ•≥ÔºöÂõ†‰∏∫Âà´‰∫∫ÈÉΩËØ¥ÊàëÁ©øÁ∫¢Ëâ≤ÁöÑË°£ÊúçÂ•ΩÁúã„ÄÇÈóÆÔºöÂ•≥ÁöÑ‰∏∫‰ªÄ‰πàÊØèÂ§©ÈÉΩÁ©øÁùÄÁ∫¢Ëâ≤ÁöÑË°£ÊúçÔºü', options: ['A ÂñúÊ¨¢Á∫¢Ëâ≤', 'B ÂñúÊ¨¢Ë°£Êúç', 'C Âà´‰∫∫ËØ¥Â•ΩÁúã'], correct: 'C' },
        { id: 15, type: 'audio-options', audioText: 'Áî∑ÔºöÈÇ£‰∏™Á¨ëÁùÄËØ¥ËØùÁöÑÂ•≥Â≠©ÂÑøÊòØË∞ÅÔºüÂ•≥ÔºöÂì™‰∏™ÔºüÊòØÁ©øÁ∫¢Ë°£ÊúçÁöÑÈÇ£‰∏™ÂêóÔºüÁî∑ÔºöÂØπÔºåÂ∞±ÊòØÂ•π„ÄÇÂ•≥ÔºöÂ•πÊòØÊñ∞Êù•ÁöÑÂ≠¶ÁîüÔºåÊàë‰πü‰∏çËÆ§ËØÜ„ÄÇÈóÆÔºöË∞ÅËÆ§ËØÜÈÇ£‰∏™Â•≥Â≠©ÂÑøÔºü', options: ['A Áî∑ÁöÑËÆ§ËØÜ', 'B Â•≥ÁöÑËÆ§ËØÜ', 'C Áî∑ÁöÑÂíåÂ•≥ÁöÑÈÉΩ‰∏çËÆ§ËØÜ'], correct: 'C' }
    ];

    // ===================== DATA READING (16-35) AWAL =====================
    const matchingImages = ['‚òïÂ∫óÂºÄÈó®', 'üë©‚Äçüè´Âùê', 'üòäüç≤', 'üö∂‚Äç‚ôÇÔ∏èüè´', 'üöñ', 'üè†'];
    const rawReading = [
        { id: 16, type: 'matching-images', question: 'Êôö‰∏äÂçÅÁÇπ‰∫ÜÔºåÂíñÂï°Â∫óËøòÂºÄÁùÄÈó®Âë¢„ÄÇ', correct: 'A' },
        { id: 17, type: 'matching-images', question: 'ËÄÅÂ∏àÊØèÂ§©ÈÉΩÂùêÁùÄÁªôÂ≠¶Áîü‰ª¨‰∏äËØæ„ÄÇ', correct: 'B' },
        { id: 18, type: 'matching-images', question: 'Â¶àÂ¶àÁ¨ëÁùÄËØ¥Ôºö‚Äú‰ªäÂ§©Áªô‰Ω†‰ª¨ÂÅö‰∫ÜÂæàÂ§öÂ•ΩÂêÉÁöÑ‰∏úË•ø‚Äù„ÄÇ', correct: 'C' },
        { id: 19, type: 'matching-images', question: 'Â≠¶Ê†°Á¶ªÊàëÂÆ∂ÂæàËøëÔºåÊàëÊØèÂ§©Ëµ∞ÁùÄÂéª‰∏äËØæ„ÄÇ', correct: 'D' },
        { id: 20, type: 'matching-images', question: 'ÊãøÁùÄËøô‰πàÂ§ö‰∏úË•øÔºåÊàë‰ª¨ËøòÊòØÂùêÂá∫ÁßüËΩ¶ÂõûÂÆ∂Âêß„ÄÇ', correct: 'E' },
        { id: 21, type: 'mc6', question: 'Â¶πÂ¶πÊòØ‰∏Ä‰∏™ÈùûÂ∏∏Áà±Ôºà ÔºâÁöÑÂ•≥Â≠©ÂÑø„ÄÇ', options: ['A Êãø', 'B Á¨ë', 'C Èïø', 'D ÂæÄ', 'E Ë¥µ', 'F ‰∏ÄÁõ¥'], correct: 'B' },
        { id: 22, type: 'mc6', question: '‰Ω†ÊâãÈáåÔºà ÔºâÁùÄÁöÑÊòØ‰ªÄ‰πà‰∏úË•øÔºåÊàëËÉΩÁúãÁúãÂêóÔºü', options: ['A Êãø', 'B Á¨ë', 'C Èïø', 'D ÂæÄ', 'E Ë¥µ', 'F ‰∏ÄÁõ¥'], correct: 'A' },
        { id: 23, type: 'mc6', question: '‰ªéËøôÂÑøÔºà ÔºâÂè≥Ëµ∞ÔºåËøá‰∏Ä‰∏™Ë∑ØÂè£ÔºåÂ∞±ÊòØÂåó‰∫¨ÂåªÈô¢„ÄÇ', options: ['A Êãø', 'B Á¨ë', 'C Èïø', 'D ÂæÄ', 'E Ë¥µ', 'F ‰∏ÄÁõ¥'], correct: 'D' },
        { id: 24, type: 'mc6', question: '‰Ω†‰ª¨Áè≠ÊúâÊ≤°Êúâ‰∏Ä‰∏™Ôºà ÔºâÁùÄÂ§ßÁúºÁùõ„ÄÅÁà±Á©øÁ∫¢Ë°£ÊúçÁöÑÂ≠¶ÁîüÔºü', options: ['A Êãø', 'B Á¨ë', 'C Èïø', 'D ÂæÄ', 'E Ë¥µ', 'F ‰∏ÄÁõ¥'], correct: 'C' },
        { id: 25, type: 'mc6', question: '‰ªéËøô‰∏™Ë∑ØÂè£Ôºà ÔºâËµ∞ÔºåÂ∞±ËÉΩÁúãÂà∞‰Ω†‰ª¨Â≠¶Ê†°‰∫Ü„ÄÇ', options: ['A Êãø', 'B Á¨ë', 'C Èïø', 'D ÂæÄ', 'E Ë¥µ', 'F ‰∏ÄÁõ¥'], correct: 'F' },
        { id: 26, type: 'tf', question: 'Â§ßÂç´‰∏çÊòØÊâæÂà∞Êñ∞Â∑•‰Ωú‰∫ÜÂêóÔºüÊÄé‰πàËøòÂ§©Â§©Âú®ÂÆ∂Áé©ÂÑøÁîµËÑëÔºü', statement: 'Â§ßÂç´ÊØèÂ§©Â∑•‰Ωú„ÄÇ', options: ['Ê≠£Á°Æ', 'ÈîôËØØ'], correct: 'ÈîôËØØ' },
        { id: 27, type: 'tf', question: 'ÊàëÁöÑ‰∏Ä‰∏™ÊúãÂèãÊ≠£Âú®ÊâæÊàøÂ≠êÔºå‰ªñÂ∏åÊúõ‰ΩèÂæóÁ¶ªÂÖ¨Âè∏Ëøë‰∏Ä‰∫õ„ÄÇ', statement: '‰ªñÂÆ∂Á¶ªÂÖ¨Âè∏ÂæàËøú„ÄÇ', options: ['Ê≠£Á°Æ', 'ÈîôËØØ'], correct: 'Ê≠£Á°Æ' },
        { id: 28, type: 'tf', question: 'Â¶àÂ¶àÂëäËØâÊàëËØ¥Ôºå‰∏çË¶ÅÂºÄÁùÄËΩ¶Âê¨Èü≥‰πê„ÄÇ', statement: 'ÂºÄÁùÄËΩ¶Âê¨Èü≥‰πê‰∏çÂ•Ω„ÄÇ', options: ['Ê≠£Á°Æ', 'ÈîôËØØ'], correct: 'Ê≠£Á°Æ' },
        { id: 29, type: 'tf', question: '‰ªéÊàëÂÆ∂Âà∞Âåó‰∫¨ÔºåÂùêÁÅ´ËΩ¶Â∞±5‰∏™Â∞èÊó∂ÔºåÊØîÂùêÈ£ûÊú∫‰æøÂÆúÂ§ö‰∫Ü„ÄÇÊâÄ‰ª•ÊàëÊòéÂ§©ÂáÜÂ§áÂùêÁÅ´ËΩ¶ÂéªÂåó‰∫¨„ÄÇ', statement: 'ÊàëÊ≠£Âú®ÂùêÁÅ´ËΩ¶ÂéªÂåó‰∫¨„ÄÇ', options: ['Ê≠£Á°Æ', 'ÈîôËØØ'], correct: 'ÈîôËØØ' },
        { id: 30, type: 'tf', question: 'ÊùéÂì•Ôºå‰Ω†ÊâãÈáåÊãøÁùÄÁöÑÊòØÁîµÂΩ±Á•®ÂêóÔºüÊàë‰πüÊÉ≥Ë∑ü‰Ω†‰∏ÄËµ∑ÂéªÁúãÁîµÂΩ±„ÄÇ', statement: 'ÊùéÂì•ÂèØËÉΩÊúâÁîµÂΩ±Á•®„ÄÇ', options: ['Ê≠£Á°Æ', 'ÈîôËØØ'], correct: 'Ê≠£Á°Æ' },
        { id: 31, type: 'match', question: 'ÊàëÁúãËßÅÂú®ÊïôÂÆ§ÈáåÂùêÁùÄÂæàÂ§öÂ≠¶Áîü„ÄÇ', options: ['A ÊòØÁªôÊàëÂ¶àÂ¶à‰π∞ÁöÑÊñ∞Ë°£ÊúçÔºåÊòéÂ§©ÊòØÂ•πÁöÑÁîüÊó•„ÄÇ', 'B ‰ªñÂºÄÁùÄËΩ¶Âá∫Âéª‰∫Ü„ÄÇ‰∏ãÂçàÂèØËÉΩÂõûÊù•„ÄÇ', 'C Â§ßÂç´‰πüÊÉ≥Ë∑üÊàë‰ª¨‰∏ÄËµ∑Âéª„ÄÇ', 'D ‰∏çÊòØ‰∏§Âπ¥ÔºåÊòØ‰∏ÄÂπ¥Âçä„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F ÊïôÂÆ§ÂâçÈù¢ËøòÊúâ‰∏Ä‰ΩçËÄÅÂ∏àÔºå‰ªñÊ≠£Âú®ÁªôÂ≠¶Áîü‰ª¨‰∏äËØæÂë¢„ÄÇ'], correct: 'F' },
        { id: 32, type: 'match', question: '‰Ω†ÊâãÈáåÊãøÁùÄ‰ªÄ‰πàÔºü', options: ['A ÊòØÁªôÊàëÂ¶àÂ¶à‰π∞ÁöÑÊñ∞Ë°£ÊúçÔºåÊòéÂ§©ÊòØÂ•πÁöÑÁîüÊó•„ÄÇ', 'B ‰ªñÂºÄÁùÄËΩ¶Âá∫Âéª‰∫Ü„ÄÇ‰∏ãÂçàÂèØËÉΩÂõûÊù•„ÄÇ', 'C Â§ßÂç´‰πüÊÉ≥Ë∑üÊàë‰ª¨‰∏ÄËµ∑Âéª„ÄÇ', 'D ‰∏çÊòØ‰∏§Âπ¥ÔºåÊòØ‰∏ÄÂπ¥Âçä„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F ÊïôÂÆ§ÂâçÈù¢ËøòÊúâ‰∏Ä‰ΩçËÄÅÂ∏àÔºå‰ªñÊ≠£Âú®ÁªôÂ≠¶Áîü‰ª¨‰∏äËØæÂë¢„ÄÇ'], correct: 'A' },
        { id: 33, type: 'match', question: 'Âº†ÂÖàÁîüÂë¢ÔºüÊàë‰ªäÂ§©ÊÄé‰πàÊ≤°ÁúãËßÅ‰ªñÔºü', options: ['A ÊòØÁªôÊàëÂ¶àÂ¶à‰π∞ÁöÑÊñ∞Ë°£ÊúçÔºåÊòéÂ§©ÊòØÂ•πÁöÑÁîüÊó•„ÄÇ', 'B ‰ªñÂºÄÁùÄËΩ¶Âá∫Âéª‰∫Ü„ÄÇ‰∏ãÂçàÂèØËÉΩÂõûÊù•„ÄÇ', 'C Â§ßÂç´‰πüÊÉ≥Ë∑üÊàë‰ª¨‰∏ÄËµ∑Âéª„ÄÇ', 'D ‰∏çÊòØ‰∏§Âπ¥ÔºåÊòØ‰∏ÄÂπ¥Âçä„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F ÊïôÂÆ§ÂâçÈù¢ËøòÊúâ‰∏Ä‰ΩçËÄÅÂ∏àÔºå‰ªñÊ≠£Âú®ÁªôÂ≠¶Áîü‰ª¨‰∏äËØæÂë¢„ÄÇ'], correct: 'B' },
        { id: 34, type: 'match', question: '‰∏ãÂçà‰∏âÁÇπÔºå‰Ω†Âú®Â≠¶Ê†°Èó®Âè£Á≠âÁùÄÊàë„ÄÇÊàë‰ª¨‰∏ÄËµ∑ÂéªÊâìÁØÆÁêÉ„ÄÇ', options: ['A ÊòØÁªôÊàëÂ¶àÂ¶à‰π∞ÁöÑÊñ∞Ë°£ÊúçÔºåÊòéÂ§©ÊòØÂ•πÁöÑÁîüÊó•„ÄÇ', 'B ‰ªñÂºÄÁùÄËΩ¶Âá∫Âéª‰∫Ü„ÄÇ‰∏ãÂçàÂèØËÉΩÂõûÊù•„ÄÇ', 'C Â§ßÂç´‰πüÊÉ≥Ë∑üÊàë‰ª¨‰∏ÄËµ∑Âéª„ÄÇ', 'D ‰∏çÊòØ‰∏§Âπ¥ÔºåÊòØ‰∏ÄÂπ¥Âçä„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F ÊïôÂÆ§ÂâçÈù¢ËøòÊúâ‰∏Ä‰ΩçËÄÅÂ∏àÔºå‰ªñÊ≠£Âú®ÁªôÂ≠¶Áîü‰ª¨‰∏äËØæÂë¢„ÄÇ'], correct: 'C' },
        { id: 35, type: 'match', question: '‰Ω†‰∏çÊòØÂ≠¶Ëøá‰∏§Âπ¥Ê±âËØ≠ÂêóÔºü', options: ['A ÊòØÁªôÊàëÂ¶àÂ¶à‰π∞ÁöÑÊñ∞Ë°£ÊúçÔºåÊòéÂ§©ÊòØÂ•πÁöÑÁîüÊó•„ÄÇ', 'B ‰ªñÂºÄÁùÄËΩ¶Âá∫Âéª‰∫Ü„ÄÇ‰∏ãÂçàÂèØËÉΩÂõûÊù•„ÄÇ', 'C Â§ßÂç´‰πüÊÉ≥Ë∑üÊàë‰ª¨‰∏ÄËµ∑Âéª„ÄÇ', 'D ‰∏çÊòØ‰∏§Âπ¥ÔºåÊòØ‰∏ÄÂπ¥Âçä„ÄÇ', 'E ‰ªñÂú®Âì™ÂÑøÂë¢Ôºü‰Ω†ÁúãËßÅ‰ªñ‰∫ÜÂêóÔºü', 'F ÊïôÂÆ§ÂâçÈù¢ËøòÊúâ‰∏Ä‰ΩçËÄÅÂ∏àÔºå‰ªñÊ≠£Âú®ÁªôÂ≠¶Áîü‰ª¨‰∏äËØæÂë¢„ÄÇ'], correct: 'D' }
    ];

    // Acak urutan soal dan opsi
    let listeningQuestions = shuffleArray(rawListening.slice());
    listeningQuestions.forEach(q => shuffleOptions(q));

    let readingQuestions = shuffleArray(rawReading.slice());
    readingQuestions.forEach(q => shuffleOptions(q));

    // ===================== STATE =====================
    let currentTab = 'listening';
    let currentIndex = 0;
    let listeningAnswers = {};
    let readingAnswers = {};
    let listeningSecondsLeft = 900; // 20 menit
    let readingSecondsLeft = 1200;   // 25 menit
    let currentSecondsLeft = listeningSecondsLeft;
    let perQuestionSecondsLeft = 60;
    let globalTimerInterval, perQuestionInterval;
    let testSubmitted = false;
    let playerName = '';

    // DOM elements
    const questionArea = document.getElementById('questionArea');
    const questionNav = document.getElementById('questionNav');
    const globalTimerEl = document.getElementById('globalTimer');
    const questionTimerEl = document.getElementById('questionTimer');
    const tabListening = document.getElementById('tabListening');
    const tabReading = document.getElementById('tabReading');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const submitBtn = document.getElementById('submitBtn');
    const reportSection = document.getElementById('reportSection');
    const listeningScoreEl = document.getElementById('listeningScore');
    const readingScoreEl = document.getElementById('readingScore');
    const totalScoreEl = document.getElementById('totalScore');
    const reviewBtn = document.getElementById('reviewBtn');
    const reviewDetails = document.getElementById('reviewDetails');
    const closeReportBtn = document.getElementById('closeReportBtn');
    const playerIdInput = document.getElementById('playerIdInput');
    const setPlayerBtn = document.getElementById('setPlayerBtn');
    const playerDisplay = document.getElementById('playerDisplay');
    const playerReport = document.getElementById('playerReport');

    setPlayerBtn.addEventListener('click', () => {
        const val = playerIdInput.value.trim();
        playerName = val || 'Tanpa Nama';
        playerDisplay.textContent = playerName;
    });

    function speak(text) {
        if (!window.speechSynthesis) return alert('Browser tidak mendukung speech synthesis');
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-CN';
        utterance.rate = 0.9;
        speechSynthesis.cancel();
        speechSynthesis.speak(utterance);
    }

    function getCurrentList() {
        return currentTab === 'listening' ? listeningQuestions : readingQuestions;
    }

    function getCurrentAnswers() {
        return currentTab === 'listening' ? listeningAnswers : readingAnswers;
    }

    function saveAnswer(id, value) {
        if (testSubmitted) return;
        if (currentTab === 'listening') listeningAnswers[id] = value;
        else readingAnswers[id] = value;
        checkAllAnswered();
    }

    function getAnswer(id) {
        return getCurrentAnswers()[id] || null;
    }

    function checkAllAnswered() {
        const totalListening = listeningQuestions.length;
        const totalReading = readingQuestions.length;
        let listeningCount = 0;
        listeningQuestions.forEach(q => { if (listeningAnswers[q.id]) listeningCount++; });
        let readingCount = 0;
        readingQuestions.forEach(q => { if (readingAnswers[q.id]) readingCount++; });
        if (listeningCount === totalListening && readingCount === totalReading) {
            submitBtn.classList.add('active');
            submitBtn.disabled = false;
        } else {
            submitBtn.classList.remove('active');
            submitBtn.disabled = true;
        }
    }

    function updateGlobalTimerDisplay() {
        const mins = Math.floor(currentSecondsLeft / 60);
        const secs = currentSecondsLeft % 60;
        globalTimerEl.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
    }

    function switchTab(tab) {
        if (testSubmitted) return;
        if (currentTab === 'listening') listeningSecondsLeft = currentSecondsLeft;
        else readingSecondsLeft = currentSecondsLeft;
        currentTab = tab;
        currentIndex = 0;
        currentSecondsLeft = (tab === 'listening') ? listeningSecondsLeft : readingSecondsLeft;
        tabListening.classList.toggle('active', tab === 'listening');
        tabReading.classList.toggle('active', tab === 'reading');
        updateGlobalTimerDisplay();
        renderQuestion();
        resetPerQuestionTimer();
    }

    function renderQuestion() {
        if (testSubmitted) return;
        const list = getCurrentList();
        if (!list.length) return;
        const q = list[currentIndex];
        const answer = getAnswer(q.id);

        let header = `<div class="question-header"><span>Soal ${q.id}</span><span>${currentTab==='listening'?'üéß Listening':'üìñ Reading'}</span>`;
        if (currentTab === 'listening') {
            header += `<button class="play-audio" data-audio="${(q.audioText || '').replace(/"/g, '&quot;')}">üîä Putar Suara</button>`;
        }
        header += '</div>';

        let content = '';

        if (currentTab === 'listening' && q.type === 'image') {
            content += `<div style="text-align:center; margin:20px 0;">(Putar suara dan pilih gambar yang sesuai)</div>`;
            content += `<div class="image-options">`;
            q.options.forEach((emoji, idx) => {
                const letter = String.fromCharCode(65 + idx);
                const sel = (answer === letter) ? 'selected' : '';
                content += `<div class="image-option ${sel}" data-value="${letter}"><span>${emoji}</span><div class="letter">${letter}</div></div>`;
            });
            content += `</div>`;
        }
        else if (currentTab === 'listening' && q.type === 'audio-options') {
            content += `<div style="text-align:center; margin:20px 0;">(Putar suara, lalu pilih jawaban)</div>`;
            content += `<div class="options">`;
            q.options.forEach((opt, idx) => {
                const letter = String.fromCharCode(65 + idx);
                const sel = (answer === letter) ? 'selected' : '';
                content += `<div class="option ${sel}" data-value="${letter}"><input type="radio" name="q" value="${letter}" ${sel ? 'checked' : ''}><span>${opt}</span></div>`;
            });
            content += `</div>`;
        }
        else if (currentTab === 'reading' && q.type === 'matching-images') {
            content += `<div class="matching-grid">`;
            matchingImages.forEach((img, idx) => {
                const letter = String.fromCharCode(65 + idx);
                content += `<div class="grid-item"><span>${img}</span><div class="label">${letter}</div></div>`;
            });
            content += `</div>`;
            content += `<div class="question-text">${q.question}</div>`;
            content += `<div class="letter-options">`;
            for (let i = 0; i < 6; i++) {
                const letter = String.fromCharCode(65 + i);
                const sel = (answer === letter) ? 'selected' : '';
                content += `<div class="letter-option ${sel}" data-value="${letter}">${letter}</div>`;
            }
            content += `</div>`;
        }
        else if (currentTab === 'reading' && q.type === 'image-choice') {
            content += `<div class="question-text">${q.question}</div>`;
            content += `<div class="image-options">`;
            q.options.forEach((emoji, idx) => {
                const letter = String.fromCharCode(65 + idx);
                const sel = (answer === letter) ? 'selected' : '';
                content += `<div class="image-option ${sel}" data-value="${letter}"><span>${emoji}</span><div class="letter">${letter}</div></div>`;
            });
            content += `</div>`;
        }
        else if (currentTab === 'reading' && (q.type === 'mc6' || q.type === 'match')) {
            content += `<div class="question-text">${q.question}</div>`;
            if (q.statement) content += `<div class="statement-text">‚òÖ ${q.statement}</div>`;
            content += `<div class="options">`;
            q.options.forEach((opt, idx) => {
                const letter = String.fromCharCode(65 + idx);
                const sel = (answer === letter) ? 'selected' : '';
                content += `<div class="option ${sel}" data-value="${letter}"><input type="radio" name="q" value="${letter}" ${sel ? 'checked' : ''}><span>${opt}</span></div>`;
            });
            content += `</div>`;
        }
        else if (currentTab === 'reading' && q.type === 'tf') {
            content += `<div class="question-text">${q.question}</div>`;
            content += `<div class="statement-text">‚òÖ ${q.statement}</div>`;
            content += `<div class="options">`;
            q.options.forEach((opt, idx) => {
                const letter = String.fromCharCode(65 + idx);
                const sel = (answer === letter) ? 'selected' : '';
                content += `<div class="option ${sel}" data-value="${letter}"><input type="radio" name="q" value="${letter}" ${sel ? 'checked' : ''}><span>${opt}</span></div>`;
            });
            content += `</div>`;
        }
        else {
            content += `<div class="question-text">${q.question || ''}</div>`;
        }

        questionArea.innerHTML = header + content;

        // Event listeners
        const playBtn = document.querySelector('.play-audio');
        if (playBtn) playBtn.addEventListener('click', (e) => speak(playBtn.dataset.audio));

        if (currentTab === 'reading' && q.type === 'matching-images') {
            document.querySelectorAll('.letter-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    if (testSubmitted) return;
                    document.querySelectorAll('.letter-option').forEach(el => el.classList.remove('selected'));
                    opt.classList.add('selected');
                    saveAnswer(q.id, opt.dataset.value);
                });
            });
        }
        else if ( (currentTab === 'listening' && q.type === 'image') || (currentTab === 'reading' && q.type === 'image-choice') ) {
            document.querySelectorAll('.image-option').forEach(opt => {
                opt.addEventListener('click', () => {
                    if (testSubmitted) return;
                    document.querySelectorAll('.image-option').forEach(el => el.classList.remove('selected'));
                    opt.classList.add('selected');
                    saveAnswer(q.id, opt.dataset.value);
                });
            });
        } else {
            document.querySelectorAll('.option').forEach(opt => {
                opt.addEventListener('click', function() {
                    if (testSubmitted) return;
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    document.querySelectorAll('.option').forEach(el => el.classList.remove('selected'));
                    this.classList.add('selected');
                    saveAnswer(q.id, this.dataset.value);
                });
            });
        }

        renderNav();
    }

    function renderNav() {
        const list = getCurrentList();
        let html = '';
        list.forEach((q, idx) => {
            const active = (idx === currentIndex) ? 'active-question' : '';
            html += `<button class="nav-btn ${active}" data-index="${idx}">${q.id}</button>`;
        });
        questionNav.innerHTML = html;
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                if (testSubmitted) return;
                const idx = parseInt(btn.dataset.index);
                if (!isNaN(idx) && idx >= 0 && idx < list.length) {
                    currentIndex = idx;
                    renderQuestion();
                    resetPerQuestionTimer();
                }
            });
        });
    }

    function startGlobalTimer() {
        globalTimerInterval = setInterval(() => {
            if (testSubmitted) return;
            if (currentSecondsLeft > 0) {
                currentSecondsLeft--;
                updateGlobalTimerDisplay();
            } else {
                clearInterval(globalTimerInterval);
                clearInterval(perQuestionInterval);
                alert(`‚è∞ Waktu ${currentTab==='listening'?'Listening':'Reading'} habis!`);
            }
        }, 1000);
    }

    function resetPerQuestionTimer() {
        if (testSubmitted) return;
        perQuestionSecondsLeft = 60;
        updatePerQuestionDisplay();
        if (perQuestionInterval) clearInterval(perQuestionInterval);
        perQuestionInterval = setInterval(() => {
            if (testSubmitted) return;
            perQuestionSecondsLeft--;
            if (perQuestionSecondsLeft <= 0) {
                perQuestionSecondsLeft = 0;
                updatePerQuestionDisplay();
                const list = getCurrentList();
                if (currentIndex < list.length - 1) {
                    currentIndex++;
                    renderQuestion();
                    resetPerQuestionTimer();
                } else {
                    clearInterval(perQuestionInterval);
                }
            } else {
                updatePerQuestionDisplay();
            }
        }, 1000);
    }

    function updatePerQuestionDisplay() {
        questionTimerEl.textContent = `00:${perQuestionSecondsLeft.toString().padStart(2, '0')}`;
    }

    function submitQuiz() {
        if (testSubmitted) return;
        testSubmitted = true;
        clearInterval(globalTimerInterval);
        clearInterval(perQuestionInterval);

        let listeningCorrect = 0;
        listeningQuestions.forEach(q => { if (listeningAnswers[q.id] === q.correct) listeningCorrect++; });
        let readingCorrect = 0;
        readingQuestions.forEach(q => { if (readingAnswers[q.id] === q.correct) readingCorrect++; });

        listeningScoreEl.textContent = `Listening: ${listeningCorrect}/15`;
        readingScoreEl.textContent = `Reading: ${readingCorrect}/20`;
        totalScoreEl.textContent = `Total: ${listeningCorrect+readingCorrect}/35`;
        playerReport.textContent = `Peserta: ${playerName || 'Belum diisi'}`;

        questionArea.style.display = 'none';
        questionNav.style.display = 'none';
        prevBtn.style.display = 'none';
        nextBtn.style.display = 'none';
        submitBtn.style.display = 'none';
        reportSection.classList.remove('hidden');

        reviewBtn.onclick = () => {
            let html = '<h3>‚ùå Jawaban Salah / Tidak Dijawab</h3>';
            let hasWrong = false;
            [...listeningQuestions, ...readingQuestions].forEach(q => {
                const ans = q.id <= 15 ? listeningAnswers[q.id] : readingAnswers[q.id];
                if (!ans || ans !== q.correct) {
                    hasWrong = true;
                    html += `<div class="review-item"><strong>Soal ${q.id}</strong> (${q.id<=15?'Listening':'Reading'})<br>Jawabanmu: ${ans || 'kosong'} | Seharusnya: ${q.correct}<br>${q.audioText ? 'Soal listening (audio)' : (q.question ? q.question.substring(0,60)+'...' : 'gambar')}</div>`;
                }
            });
            if (!hasWrong) html += '<p>Semua jawaban benar! üéâ</p>';
            reviewDetails.innerHTML = html;
            reviewDetails.classList.toggle('hidden');
        };

        closeReportBtn.onclick = () => location.reload();
    }

    function init() {
        renderQuestion();
        startGlobalTimer();
        resetPerQuestionTimer();
        checkAllAnswered(); // in case sudah ada jawaban? tidak, baru mulai

        tabListening.addEventListener('click', () => switchTab('listening'));
        tabReading.addEventListener('click', () => switchTab('reading'));

        prevBtn.addEventListener('click', () => {
            if (testSubmitted) return;
            const list = getCurrentList();
            if (currentIndex > 0) {
                currentIndex--;
                renderQuestion();
                resetPerQuestionTimer();
            }
        });

        nextBtn.addEventListener('click', () => {
            if (testSubmitted) return;
            const list = getCurrentList();
            if (currentIndex < list.length - 1) {
                currentIndex++;
                renderQuestion();
                resetPerQuestionTimer();
            }
        });

        submitBtn.addEventListener('click', submitQuiz);
    }

    init();
})();
</script>
</body>
</html>